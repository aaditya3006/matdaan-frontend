<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Democrazy | Blockchain Voting Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>

    <style>
        /* ── RESET & BASE ── */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Inter', sans-serif; font-size: 14px; color: #111827; background: #f8fafc; -webkit-font-smoothing: antialiased; }
        button { font-family: inherit; cursor: pointer; }

        /* ── LAYOUT ── */
        #root { display: flex; height: 100vh; overflow: hidden; }

        /* ── SIDEBAR ── */
        .sb { width: 260px; flex-shrink: 0; background: #fff; border-right: 1px solid #e5e7eb; display: flex; flex-direction: column; height: 100vh; position: relative; }
        .sb-scroll { flex: 1; overflow-y: auto; overflow-x: hidden; }
        .sb-brand { display: flex; flex-direction: column; align-items: center; padding: 20px 15px 10px; cursor: pointer; }
        .sb-logo-img { width: 180px; height: auto; object-fit: contain; transition: transform 0.2s; }
        .sb-logo-img:hover { transform: scale(1.02); }
        .sb-label { padding: 25px 24px 8px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: #94a3b8; }
        .sb-item { display: flex; align-items: center; gap: 12px; padding: 12px 24px; color: #4b5563; font-weight: 500; transition: 0.15s; background: none; border: none; width: 100%; text-align: left; }
        .sb-item i { font-size: 16px; width: 20px; text-align: center; }
        .sb-item:hover, .sb-item.sb-active { background: #f8fafc; color: #111827; }
        .sb-item.sb-active { font-weight: 700; background: #f1f5f9; color: #111827; border-right: 4px solid #1e293b; }
        .sb-sub { overflow: hidden; max-height: 0; transition: max-height 0.3s ease; background: #fafafa; }
        .sb-sub.open { max-height: 200px; }
        .sb-subitem { display: block; padding: 10px 24px 10px 56px; font-size: 13px; color: #64748b; text-decoration: none; cursor: pointer; transition: 0.2s; }
        .sb-subitem:hover { color: #111827; background: #f1f5f9; }

        /* ── MAIN AREA ── */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .page { display: none; flex: 1; flex-direction: column; overflow-y: auto; padding: 32px; background: #f8fafc; }
        .page.active { display: flex; }

        /* ── DASHBOARD HEADER ── */
        .dash-header { margin-bottom: 32px; position: relative; }
        .dash-header h1 { font-size: 28px; font-weight: 800; color: #0f172a; }
        .dash-header p { color: #64748b; margin-top: 4px; }
        .btn-new-top { position: absolute; top: 0; right: 0; background: #0f172a; color: #fff; padding: 10px 20px; border-radius: 8px; font-weight: 600; display: flex; align-items: center; gap: 8px; border: none; cursor: pointer; z-index: 10; }

        /* ── STATS GRID ── */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 32px; }
        .ds-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; display: flex; justify-content: space-between; align-items: flex-start; }
        .ds-info { flex: 1; }
        .ds-info .label { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #64748b; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .ds-info .val { font-size: 28px; font-weight: 800; color: #0f172a; }
        .ds-card i.icon-bg { font-size: 18px; color: #cbd5e1; }

        /* ── LOWER DASHBOARD ── */
        .dash-lower { display: grid; grid-template-columns: 1fr 1.2fr; gap: 24px; }
        .panel { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; display: flex; flex-direction: column; }
        .panel-title { font-weight: 700; font-size: 15px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .qa-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .qa-btn { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: 0.2s; }
        .qa-btn:hover { background: #f1f5f9; border-color: #cbd5e1; }
        .qa-btn i { font-size: 20px; margin-bottom: 10px; display: block; }
        .qa-btn span { font-size: 13px; font-weight: 600; color: #334155; }
        .tabs-header { display: flex; gap: 20px; border-bottom: 1px solid #f1f5f9; margin-bottom: 15px; }
        .tab-btn { padding: 8px 0; font-size: 14px; font-weight: 600; color: #94a3b8; border-bottom: 2px solid transparent; cursor: pointer; }
        .tab-btn.active { color: #3b82f6; border-color: #3b82f6; }
        .chart-container { flex: 1; min-height: 220px; }

        /* ── ELECTION LIST VIEW ── */
        .el-table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; }
        .el-table th { background: #f8fafc; padding: 16px; text-align: left; font-size: 12px; color: #64748b; text-transform: uppercase; font-weight: 700; }
        .el-table td { padding: 16px; border-top: 1px solid #f1f5f9; vertical-align: middle; cursor: pointer; }
        .el-table tr:hover td { background: #fcfdfe; }
        .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: #e2e8f0; color: #475569; }
        .status-badge.completed { background: #f1f5f9; color: #475569; }

        /* ── ELECTION DETAIL VIEW ── */
        .detail-top { display: flex; align-items: center; gap: 15px; margin-bottom: 24px; }
        .detail-tabs { display: flex; gap: 8px; margin-bottom: 24px; background: #fff; padding: 6px; border-radius: 12px; border: 1px solid #e2e8f0; overflow-x: auto; }
        .d-tab { padding: 8px 16px; border-radius: 8px; font-weight: 600; color: #64748b; cursor: pointer; display: flex; align-items: center; gap: 8px; white-space: nowrap; }
        .d-tab.active { background: #f1f5f9; color: #0f172a; }
        .grid-detail { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
        .detail-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; }
        .inner-panel-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 24px; }

        /* ── VOTER ROSTER ── */
        .roster-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding: 0 10px; }
        .roster-stats { font-size: 13px; color: #64748b; line-height: 1.5; }
        .roster-actions { display: flex; gap: 10px; }
        .btn-outline { padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 8px; background: #fff; font-size: 13px; font-weight: 600; color: #334155; display: flex; align-items: center; gap: 8px; }
        .search-bar-container { position: relative; margin-bottom: 20px; display: flex; align-items: center; }
        .search-bar-container i { position: absolute; left: 15px; color: #94a3b8; z-index: 1; }
        .search-bar { width: 100%; padding: 12px 12px 12px 40px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 14px; outline: none; }
        .filter-select { position: absolute; right: 10px; border: none; background: #f8fafc; font-size: 13px; font-weight: 600; padding: 5px 10px; border-radius: 6px; cursor: pointer; }
        
        /* CORRECTED SCROLLABLE AREA */
        #voter-list-container { max-height: 500px; overflow-y: auto; }
        .voter-item { display: flex; align-items: center; padding: 16px 24px; background: #fff; border-bottom: 1px solid #f1f5f9; transition: 0.15s; }
        .voter-item:last-child { border-bottom: none; }
        .voter-checkbox { margin-right: 20px; width: 16px; height: 16px; cursor: pointer; }
        .voter-info { flex: 1; min-width: 0; }
        .voter-name { font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .tag-unused { font-size: 10px; font-weight: 800; color: #94a3b8; background: #f1f5f9; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }
        .voter-meta { font-size: 12px; color: #94a3b8; margin-top: 4px; }
        .voter-key-container { display: flex; align-items: center; gap: 15px; }
        .key-label-stack { display: flex; flex-direction: column; align-items: flex-end; margin-right: 5px; }
        .voter-key-box { background: #f8fafc; border: 1px solid #e2e8f0; padding: 8px 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; color: #475569; font-weight: 600; letter-spacing: 0.5px; min-width: 130px; text-align: center; }
        .voter-btn-group { display: flex; gap: 8px; }
        .voter-icon-btn { border: none; background: none; color: #94a3b8; font-size: 16px; padding: 5px; border-radius: 6px; transition: 0.2s; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .voter-icon-btn:hover { background: #f1f5f9; color: #4b5563; }
        .voter-icon-btn.eye-btn { border: 1px solid #e2e8f0; background: #fff; }

        /* ── POLL PAGE ── */
        .poll-container { display: grid; grid-template-columns: 1fr 400px; gap: 32px; padding-bottom: 50px; }
        .poll-form-section { display: flex; flex-direction: column; gap: 24px; }
        .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card-title { font-weight: 700; font-size: 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; color: #1f2937; }
        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; font-size: 13px; font-weight: 600; color: #4b5563; margin-bottom: 6px; }
        .char-count { font-size: 11px; color: #9ca3af; text-align: right; margin-top: 4px; }
        .type-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .type-option { border: 2px solid #e5e7eb; border-radius: 12px; padding: 16px; cursor: pointer; transition: 0.2s; }
        .type-option.active { border-color: #3b82f6; background: #eff6ff; }
        .type-option h4 { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
        .type-option p { font-size: 12px; color: #6b7280; }
        .option-row { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        .drag-handle { color: #d1d5db; cursor: grab; }
        .add-opt-btn { background: none; border: none; color: #3b82f6; font-weight: 600; font-size: 13px; cursor: pointer; margin-top: 8px; }
        .demo-section { position: sticky; top: 0; display: flex; flex-direction: column; align-items: center; gap: 16px; }
        .demo-label { font-size: 12px; font-weight: 700; text-transform: uppercase; color: #94a3b8; letter-spacing: 0.05em; display: flex; align-items: center; gap: 6px; }
        .phone-frame { width: 320px; height: 620px; background: #000; border-radius: 40px; padding: 12px; position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); border: 8px solid #1f2937; }
        .phone-screen { background: #fff; width: 100%; height: 100%; border-radius: 28px; overflow-y: auto; display: flex; flex-direction: column; padding: 40px 20px; position: relative; }
        .phone-screen::-webkit-scrollbar { width: 0; }
        .demo-question { font-size: 18px; font-weight: 800; color: #1e3a8a; text-align: center; margin-bottom: 24px; line-height: 1.4; }
        .demo-options { display: flex; flex-direction: column; gap: 12px; }
        .demo-opt { border: 1.5px solid #e5e7eb; border-radius: 10px; padding: 14px; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 500; color: #4b5563; }
        .demo-radio { width: 18px; height: 18px; border: 2px solid #d1d5db; border-radius: 50%; }
        .demo-submit { margin-top: auto; background: #93c5fd; color: #fff; padding: 14px; border-radius: 12px; text-align: center; font-weight: 700; cursor: default; }

        /* ── BRANDING PAGE ADDITIONS ── */
        .branding-layout { display: grid; grid-template-columns: 1fr 340px; gap: 32px; }
        .branding-form { display: flex; flex-direction: column; gap: 24px; }
        .logo-upload { border: 2px dashed #e2e8f0; border-radius: 12px; padding: 32px; text-align: center; cursor: pointer; transition: 0.2s; }
        .logo-upload:hover { border-color: #3b82f6; background: #f0f7ff; }
        .logo-upload i { font-size: 24px; color: #94a3b8; margin-bottom: 8px; }
        .theme-grid-brand { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .theme-item { border: 1.5px solid #e2e8f0; border-radius: 10px; padding: 12px; cursor: pointer; text-align: center; transition: 0.2s; position: relative; }
        .theme-item.active { border-color: #10b981; background: #f0fdf4; }
        .theme-item.active::after { content: '\f058'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; top: -8px; right: -8px; color: #10b981; background: white; border-radius: 50%; }
        .theme-color-box { width: 24px; height: 24px; border-radius: 4px; margin: 0 auto 8px; }

        /* Preview elements */
        .preview-org-name { font-size: 18px; font-weight: 800; color: #0f172a; text-align: center; margin-bottom: 4px; }
        .preview-election-title { font-size: 12px; color: #64748b; text-align: center; margin-bottom: 24px; }
        .preview-login-card { background: white; border: 1px solid #f1f5f9; padding: 24px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .preview-submit { padding: 14px; border-radius: 10px; color: white; text-align: center; font-weight: 700; margin-top: 16px; display: flex; align-items: center; justify-content: center; gap: 8px; }

        /* ── MODALS ── */
        .modal-bg { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 500; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal-bg.open { display: flex; }
        .modal-box { background: #fff; width: 90%; max-width: 700px; border-radius: 16px; padding: 32px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.15); }
        .fsec { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #94a3b8; margin: 20px 0 10px; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px; }
        .fg { margin-bottom: 16px; }
        .fg label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: #475569; }
        .fg input, .fg select, .fg textarea { width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; outline: none; font-size: 14px; }
        .g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

        /* ── TOASTS ── */
        .toast-stack { position: fixed; bottom: 24px; right: 24px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .toast { padding: 12px 20px; background: #0f172a; color: #fff; border-radius: 10px; font-size: 14px; font-weight: 500; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: tIn 0.3s ease; }
        @keyframes tIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }

        .c-blue { color: #3b82f6; } .c-green { color: #10b981; } .c-purple { color: #8b5cf6; } .c-orange { color: #f97316; }
    </style>
</head>
<body>

<div id="root">
    <nav class="sb">
        <div class="sb-scroll">
            <div class="sb-brand" onclick="showPage('dash')">
                <img src="logo.png" alt="Democrazy Logo" class="sb-logo-img">
            </div>

            <div class="sb-label">Main</div>
            <button class="sb-item sb-active" id="sbi-dash" onclick="showPage('dash')">
                <i class="fa-solid fa-house"></i> Dashboard
            </button>

            <div class="sb-label">Elections</div>
            <button class="sb-item" id="sbi-my-elections" onclick="showPage('my-elections')">
                <i class="fa-solid fa-check-to-slot"></i> My Elections
            </button>
            <button class="sb-item" onclick="openCreateModal()">
                <i class="fa-solid fa-plus"></i> Create New
            </button>

            <div class="sb-label">Polls</div>
            <button class="sb-item" id="sbi-create-poll" onclick="showPage('create-poll')">
                <i class="fa-solid fa-square-poll-vertical"></i> Create Poll
            </button>

            <div class="sb-label">Settings</div>
            <button class="sb-item" onclick="showPage('profile')"><i class="fa-regular fa-user"></i> Profile</button>
            <button class="sb-item" onclick="showPage('settings')"><i class="fa-solid fa-gear"></i> Settings</button>
        </div>
    </nav>

    <div class="main">
        <div class="page active" id="page-dash">
            <div class="dash-header">
                <h1>Dashboard</h1>
                <p>Welcome back! Here's what's happening.</p>
                <button class="btn-new-top" onclick="openCreateModal()"><i class="fa-solid fa-plus"></i> New Election</button>
            </div>

            <div class="stats-grid">
                <div class="ds-card">
                    <div class="ds-info">
                        <div class="label">Elections <i class="fa-solid fa-info-circle"></i></div>
                        <div class="val" id="stat-elec-count">1</div>
                    </div>
                    <i class="fa-solid fa-chart-simple icon-bg"></i>
                </div>
                <div class="ds-card">
                    <div class="ds-info">
                        <div class="label">Ballots <i class="fa-solid fa-circle-question"></i></div>
                        <div class="val">0</div>
                    </div>
                    <i class="fa-solid fa-check-double icon-bg"></i>
                </div>
                <div class="ds-card">
                    <div class="ds-info">
                        <div class="label">Active Elections <i class="fa-solid fa-circle-question"></i></div>
                        <div class="val">0</div>
                    </div>
                    <i class="fa-solid fa-arrow-trend-up icon-bg" style="color:#10b981"></i>
                </div>
                <div class="ds-card">
                    <div class="ds-info">
                        <div class="label">Polls</div>
                        <div class="val" id="stat-polls-count">0</div>
                    </div>
                    <i class="fa-solid fa-chart-pie icon-bg"></i>
                </div>
                <div class="ds-card">
                    <div class="ds-info">
                        <div class="label">Active Polls</div>
                        <div class="val" id="stat-active-polls">0</div>
                    </div>
                    <i class="fa-solid fa-bolt icon-bg" style="color:#10b981"></i>
                </div>
                <div class="ds-card">
                    <div class="ds-info">
                        <div class="label">Poll Votes</div>
                        <div class="val">0</div>
                    </div>
                    <i class="fa-solid fa-users icon-bg"></i>
                </div>
            </div>

            <div class="dash-lower">
                <div class="panel">
                    <div class="panel-title"><i class="fa-solid fa-bolt c-orange"></i> Quick Actions</div>
                    <div class="qa-grid">
                        <div class="qa-btn" onclick="openCreateModal()">
                            <i class="fa-solid fa-plus c-blue"></i>
                            <span>New Election</span>
                        </div>
                        <div class="qa-btn" onclick="showPage('create-poll')">
                            <i class="fa-solid fa-plus c-green"></i>
                            <span>New Poll</span>
                        </div>
                        <div class="qa-btn" onclick="showPage('my-elections')">
                            <i class="fa-solid fa-list-ul c-purple"></i>
                            <span>All Elections</span>
                        </div>
                        <div class="qa-btn" onclick="toast('Log coming soon','inf')">
                            <i class="fa-solid fa-clock-rotate-left c-orange"></i>
                            <span>All Polls</span>
                        </div>
                    </div>
                </div>
                <div class="panel">
                    <div class="tabs-header">
                        <div class="tab-btn active">Ballots</div>
                        <div class="tab-btn">Poll Votes</div>
                        <span style="margin-left:auto; font-size:12px; color:#94a3b8">Past 7 days</span>
                    </div>
                    <div class="chart-container"><canvas id="activityChart"></canvas></div>
                </div>
            </div>
        </div>

        <div class="page" id="page-my-elections">
            <div class="dash-header">
                <h1>My Elections</h1>
                <p>Manage and monitor all your created elections.</p>
                <button class="btn-new-top" onclick="openCreateModal()"><i class="fa-solid fa-plus"></i> Create Election</button>
            </div>
            
            <div class="detail-tabs" style="margin-bottom:15px; border:none; background:transparent;">
                <div class="tab-btn active">All 1</div>
                <div class="tab-btn">Draft 0</div>
                <div class="tab-btn">Scheduled 0</div>
                <div class="tab-btn">Active 0</div>
                <div class="tab-btn">Completed 1</div>
            </div>

            <div class="card" style="padding:0; overflow:hidden;">
                <table class="el-table">
                    <thead>
                        <tr>
                            <th>Election Name <i class="fa-solid fa-arrow-down-up-across"></i></th>
                            <th>Status <i class="fa-solid fa-arrow-down-up-across"></i></th>
                            <th>Method</th>
                            <th>Ballots</th>
                            <th>Turnout</th>
                            <th>Schedule <i class="fa-solid fa-arrow-down-up-across"></i></th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr onclick="showElectionDetail('yadav samaj')">
                            <td style="font-weight:700">yadav samaj</td>
                            <td><span class="status-badge completed">Completed</span></td>
                            <td>Direct Election</td>
                            <td>0</td>
                            <td>0.0%</td>
                            <td style="font-size:11px; color:#64748b">19 Feb 2026 14:12 – 19 Feb 2026 14:15<br>Expires in 90 days</td>
                            <td><i class="fa-solid fa-ellipsis-h"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="page" id="page-election-detail">
            <div class="detail-top">
                <button onclick="showPage('my-elections')" style="background:none; border:none; color:#64748b;"><i class="fa-solid fa-chevron-left"></i></button>
                <h1 id="detail-title" style="font-size:24px; font-weight:800;">yadav samaj</h1>
                <span class="status-badge">Completed</span>
                <span style="font-size:12px; color:#64748b; background:#f1f5f9; padding:4px 10px; border-radius:20px;">90 days until deletion</span>
                <div style="margin-left:auto; display:flex; gap:10px;">
                    <button class="qa-btn" style="padding:8px 16px; font-size:12px;"><i class="fa-solid fa-eye"></i> Preview</button>
                    <button class="qa-btn" style="padding:8px 12px;"><i class="fa-solid fa-rotate"></i></button>
                </div>
            </div>

            <div class="detail-tabs">
                <div class="d-tab active" onclick="switchElectionTab('overview')"><i class="fa-solid fa-th-large"></i> Overview</div>
                <div class="d-tab" onclick="switchElectionTab('positions')"><i class="fa-solid fa-users"></i> Positions</div>
                <div class="d-tab" onclick="switchElectionTab('voters')"><i class="fa-solid fa-user-check"></i> Voters</div>
                <div class="d-tab" onclick="switchElectionTab('branding')"><i class="fa-solid fa-palette"></i> Branding</div>
                <div class="d-tab"><i class="fa-solid fa-globe"></i> Languages</div>
                <div class="d-tab"><i class="fa-solid fa-cog"></i> Settings</div>
                <div class="d-tab"><i class="fa-solid fa-chart-bar"></i> Results</div>
                <div class="d-tab"><i class="fa-solid fa-file-export"></i> Export</div>
            </div>

            <div id="detail-overview-content">
                <div class="grid-detail">
                    <div class="detail-card"><div class="ds-info"><div class="label">Ballots Cast</div><div class="val">0</div></div></div>
                    <div class="detail-card"><div class="ds-info"><div class="label">Voter Keys</div><div class="val">10</div></div></div>
                    <div class="detail-card"><div class="ds-info"><div class="label">Turnout</div><div class="val" style="color:#10b981">0.0%</div></div></div>
                    <div class="detail-card"><div class="ds-info"><div class="label">Positions</div><div class="val">0</div></div></div>
                </div>
                <div class="inner-panel-grid">
                    <div class="detail-card">
                        <div class="panel-title"><i class="fa-solid fa-calendar"></i> Election Schedule</div>
                        <div style="font-size:13px;">
                            <p style="color:#64748b; margin-bottom:5px;">Starts</p>
                            <p style="font-weight:700; margin-bottom:15px;">2026-02-19 08:42 AM</p>
                            <p style="color:#64748b; margin-bottom:5px;">Ends</p>
                            <p style="font-weight:700;">2026-02-19 08:45 AM</p>
                        </div>
                    </div>
                    <div class="detail-card">
                        <div class="panel-title"><i class="fa-solid fa-bolt c-orange"></i> Quick Actions</div>
                        <div class="qa-grid" style="grid-template-columns: repeat(2, 1fr);">
                            <button class="qa-btn">Live Monitor</button>
                            <button class="qa-btn">Public Log</button>
                            <button class="qa-btn">Clone</button>
                            <button class="qa-btn">Edit</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="detail-voters-content" style="display:none;">
                <div class="roster-header">
                    <div class="roster-stats">
                        <i class="fa-solid fa-users-viewfinder" style="margin-right: 8px;"></i>
                        <strong>Voter Roster</strong><br>
                        Total: 10 | Voted: 0 (0%) | Pending: 10
                    </div>
                    <div class="roster-actions">
                        <button class="btn-outline"><i class="fa-solid fa-envelope"></i> Email Templates</button>
                        <button class="btn-outline"><i class="fa-solid fa-file-export"></i> Export CSV</button>
                        <button class="btn-outline"><i class="fa-solid fa-print"></i> Print Key Cards</button>
                        <button class="btn-outline" style="padding: 8px 12px;"><i class="fa-solid fa-rotate-right"></i></button>
                    </div>
                </div>

                <div class="search-bar-container">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" class="search-bar" placeholder="Search by name or email...">
                    <select class="filter-select">
                        <option>All Participants</option>
                    </select>
                </div>

                <div class="card" style="padding: 0;">
                    <div style="padding: 12px 24px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; gap: 10px; font-size: 13px; color: #64748b; font-weight: 600;">
                        <input type="checkbox" class="voter-checkbox"> Select all on this page
                    </div>
                    <div id="voter-list-container">
                        </div>
                </div>
            </div>

            <div id="detail-branding-content" style="display:none;">
                <div class="branding-layout">
                    <div class="branding-form">
                        <div class="card">
                            <div class="panel-title"><i class="fa-solid fa-building c-blue"></i> Organization Name</div>
                            <div class="fg">
                                <input type="text" id="brand-org-input" oninput="updateBrandPreview()" value="NIET">
                                <p style="font-size: 11px; color: #64748b; margin-top: 8px;">Appears at the top of every page in the voter interface.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="panel-title"><i class="fa-solid fa-image c-purple"></i> Election Logo</div>
                            <div class="logo-upload">
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <p><strong>Custom Logo</strong></p>
                                <p style="font-size: 11px; color: #94a3b8; margin-top: 4px;">Recommended: 400x400px. Square PNG or JPG.</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="panel-title"><i class="fa-solid fa-palette c-green"></i> Color Theme</div>
                            <div class="theme-grid-brand">
                                <div class="theme-item active" onclick="selectTheme(this, '#10b981', 'Fresh Green')">
                                    <div class="theme-color-box" style="background: #10b981;"></div>
                                    <span style="font-size: 11px; font-weight: 600;">Fresh Green</span>
                                </div>
                                <div class="theme-item" onclick="selectTheme(this, '#3b82f6', 'Trust Blue')">
                                    <div class="theme-color-box" style="background: #3b82f6;"></div>
                                    <span style="font-size: 11px; font-weight: 600;">Trust Blue</span>
                                </div>
                                <div class="theme-item" onclick="selectTheme(this, '#8b5cf6', 'Regal Purple')">
                                    <div class="theme-color-box" style="background: #8b5cf6;"></div>
                                    <span style="font-size: 11px; font-weight: 600;">Regal Purple</span>
                                </div>
                                <div class="theme-item" onclick="selectTheme(this, '#334155', 'Slate Minimal')">
                                    <div class="theme-color-box" style="background: #334155;"></div>
                                    <span style="font-size: 11px; font-weight: 600;">Slate Minimal</span>
                                </div>
                                <div class="theme-item" onclick="selectTheme(this, '#ef4444', 'Energetic Red')">
                                    <div class="theme-color-box" style="background: #ef4444;"></div>
                                    <span style="font-size: 11px; font-weight: 600;">Energetic Red</span>
                                </div>
                                <div class="theme-item" onclick="selectTheme(this, '#f59e0b', 'Warm Amber')">
                                    <div class="theme-color-box" style="background: #f59e0b;"></div>
                                    <span style="font-size: 11px; font-weight: 600;">Warm Amber</span>
                                </div>
                            </div>

                            <div class="g2" style="margin-top: 24px;">
                                <div class="fg"><label>Primary Color</label><input type="text" id="brand-hex-input" value="#10B981" readonly></div>
                                <div class="fg"><label>Background Color</label><input type="text" value="#FFFFFF" readonly></div>
                            </div>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fa-solid fa-toggle-off" style="font-size: 20px; color: #cbd5e1;"></i>
                                <span style="font-weight: 600;">Remove Branding Footer</span>
                            </div>
                            <button style="padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 700;" onclick="toast('Branding changes saved!')">
                                <i class="fa-solid fa-circle-check" style="margin-right: 8px;"></i> Save Branding Changes
                            </button>
                        </div>
                    </div>

                    <div class="preview-section" style="position: sticky; top: 0;">
                        <div class="demo-label" style="justify-content: center; margin-bottom: 12px;"><i class="fa-solid fa-mobile-screen"></i> Live Mobile Preview</div>
                        <div class="phone-frame">
                            <div class="phone-screen">
                                <div class="phone-inner-content" style="display: flex; flex-direction: column; align-items: center; width: 100%;">
                                    <div id="preview-logo-container" style="width: 50px; height: 50px; background: #f0fdf4; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                        <i class="fa-solid fa-check-to-slot" style="color: #10b981; font-size: 24px;" id="preview-logo-icon"></i>
                                    </div>
                                    <div class="preview-org-name" id="preview-org-display">NIET</div>
                                    <div class="preview-election-title" id="preview-election-display">yadav samaj</div>

                                    <div class="preview-login-card" style="width: 100%;">
                                        <h3 style="text-align: center; font-size: 15px; margin-bottom: 4px;">Voter Login</h3>
                                        <p style="text-align: center; font-size: 11px; color: #94a3b8; margin-bottom: 20px;">Enter your voter key</p>
                                        
                                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; padding: 12px; border-radius: 10px; display: flex; align-items: center; gap: 12px; color: #cbd5e1;">
                                            <i class="fa-solid fa-key"></i> <span>XXX-XXX-XXX</span>
                                        </div>
                                        <p style="font-size: 10px; color: #3b82f6; text-align: center; margin-top: 10px; font-weight: 600;">Use Demo Key: DEM-0VOTE-123</p>
                                        
                                        <div class="preview-submit" id="preview-btn" style="background: #10b981;">Access Ballot <i class="fa-solid fa-arrow-right"></i></div>
                                    </div>

                                    <div style="margin-top: auto; padding-top: 24px; text-align: center; font-size: 9px; color: #94a3b8;">
                                        <i class="fa-solid fa-shield-halved"></i> Secure & Anonymous<br>
                                        Powered by Democrazy.com
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="page-create-poll">
            <div class="dash-header">
                <h1>Create Poll</h1>
                <p>Ask a question and share it with anyone</p>
            </div>
            <div class="poll-container">
                <div class="poll-form-section">
                    <div class="card">
                        <div class="card-title"><i class="fa-regular fa-comment-dots c-blue"></i> Your Question</div>
                        <div class="input-group">
                            <label>Question</label>
                            <input type="text" id="poll-q-input" oninput="updateDemo()" placeholder="What's your favorite season of the year?">
                            <div class="char-count">0/200 characters</div>
                        </div>
                        <div class="input-group">
                            <label>Description (optional)</label>
                            <textarea rows="3" placeholder="Add context or instructions for voters..."></textarea>
                            <div class="char-count">0/500 characters</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="fa-regular fa-star c-purple"></i> Question Type</div>
                        <div class="type-grid">
                            <div class="type-option active"><h4>Multiple Choice</h4><p>Voters select from predefined options</p></div>
                            <div class="type-option" style="opacity: 0.6; cursor: not-allowed;"><h4>Rating Scale</h4><p>NPS, Likert, star ratings</p></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="fa-regular fa-circle-check c-green"></i> Answer Options</div>
                        <div id="options-list">
                            <div class="option-row"><i class="fa-solid fa-grip-vertical drag-handle"></i><input type="text" class="opt-input" oninput="updateDemo()" value="Spring"></div>
                            <div class="option-row"><i class="fa-solid fa-grip-vertical drag-handle"></i><input type="text" class="opt-input" oninput="updateDemo()" value="Summer"></div>
                        </div>
                        <button class="add-opt-btn" onclick="addOption()">+ Add Option</button>
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 10px;">
                        <button style="padding: 12px 24px; border-radius: 8px; border: 1px solid #e2e8f0; background: #fff; font-weight: 600;" onclick="showPage('dash')">Cancel</button>
                        <button style="flex: 1; padding: 12px 24px; border-radius: 8px; background: #0f172a; color: #fff; border: none; font-weight: 700;" onclick="createPoll()">Create Poll</button>
                    </div>
                </div>
                <div class="demo-section">
                    <div class="demo-label"><i class="fa-solid fa-eye"></i> Live Demo</div>
                    <div class="phone-frame">
                        <div class="phone-screen">
                            <div class="demo-question" id="demo-q-text">What's your favorite season of the year?</div>
                            <div class="demo-options" id="demo-options-container"></div>
                            <div class="demo-submit">Submit Vote</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="page-profile"><h1>User Profile</h1></div>
        <div class="page" id="page-settings"><h1>Platform Settings</h1></div>
    </div>
</div>

<div class="modal-bg" id="modal-create">
    <div class="modal-box" style="max-width: 900px; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
        <div style="background: #0f172a; color: white; padding: 24px 32px; display: flex; align-items: center; justify-content: space-between;">
            <div>
                <h2 style="margin: 0; font-size: 22px; letter-spacing: -0.5px;">Deploy New Election</h2>
                <p style="margin: 4px 0 0; font-size: 13px; color: #94a3b8;">Initialize a secure blockchain-backed electoral process.</p>
            </div>
            <button onclick="closeModal()" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 32px; height: 32px; border-radius: 50%;"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div style="padding: 32px; overflow-y: auto; max-height: 70vh; background: #fcfdfe;">
            
            <div class="fsec"><i class="fa-solid fa-circle-info"></i> 1. Election Basic Details</div>
            <div class="fg">
                <label>Election Title <span style="color:red">*</span></label>
                <input type="text" id="el-title" placeholder="e.g. Lok Sabha 2026 or Student Council">
            </div>
            <div class="g2">
                <div class="fg">
                    <label>Election Type <span style="color:red">*</span></label>
                    <select id="el-type">
                        <option>University / College</option>
                        <option>Parliamentary (National)</option>
                        <option>Corporate / Organizational</option>
                        <option>Others</option>
                    </select>
                </div>
                <div class="fg">
                    <label>Election Category</label>
                    <input type="text" placeholder="e.g. President, MP, Secretary">
                </div>
            </div>
            <div class="fg">
                <label>Description</label>
                <textarea rows="2" placeholder="Briefly explain the purpose of this election..."></textarea>
            </div>
            <div class="g2">
                <div class="fg">
                    <label>Organization Name <span style="color:red">*</span></label>
                    <input type="text" placeholder="Full legal name of organization">
                </div>
                <div class="fg">
                    <label>Election Logo</label>
                    <input type="file" style="padding: 6px; font-size: 12px; border: 1px dashed #cbd5e1;">
                </div>
            </div>

            <div class="fsec"><i class="fa-solid fa-calendar-days"></i> 2. Election Schedule</div>
            <div class="g2">
                <div class="fg"><label>Nomination Start Date</label><input type="datetime-local"></div>
                <div class="fg"><label>Nomination End Date</label><input type="datetime-local"></div>
            </div>
            <div class="g2">
                <div class="fg"><label>Voting Start Date <span style="color:red">*</span></label><input type="datetime-local" id="el-start"></div>
                <div class="fg"><label>Voting End Date <span style="color:red">*</span></label><input type="datetime-local" id="el-end"></div>
            </div>
            <div class="g2">
                <div class="fg"><label>Result Declaration</label><input type="datetime-local"></div>
                <div class="fg">
                    <label>Time Zone</label>
                    <select><option>IST (UTC +5:30)</option><option>UTC (Greenwich Mean Time)</option></select>
                </div>
            </div>

            <div class="fsec"><i class="fa-solid fa-user-tie"></i> 3. Organizer Information</div>
            <div class="g2">
                <div class="fg"><label>Organizer Name</label><input type="text" value="Aditya Raj"></div>
                <div class="fg"><label>Designation</label><input type="text" placeholder="e.g. Returning Officer"></div>
            </div>
            <div class="g2">
                <div class="fg"><label>Official Email</label><input type="email" placeholder="admin@org.edu"></div>
                <div class="fg"><label>Organization ID</label><input type="text" placeholder="Auth ID"></div>
            </div>

            <div class="fsec"><i class="fa-solid fa-gears"></i> 4. Voting Configuration</div>
            <div class="g2">
                <div class="fg">
                    <label>Voting Method</label>
                    <select>
                        <option>Single Choice (FPTP)</option>
                        <option>Multiple Choice</option>
                        <option>Ranked Voting (STV)</option>
                    </select>
                </div>
                <div class="fg">
                    <label>Voter ID Verification Type <span style="color:red">*</span></label>
                    <select id="el-auth">
                        <option>Email OTP</option>
                        <option>Student ID / Roll No</option>
                        <option>Voter Key (Pre-generated)</option>
                        <option>Aadhaar / Biometric (Government)</option>
                    </select>
                </div>
            </div>
            <div style="display: flex; gap: 20px; margin: 10px 0;">
                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                    <input type="checkbox" checked> Anonymous Voting
                </div>
                <div style="display: flex; align-items: center; gap: 8px; font-size: 13px;">
                    <input type="checkbox"> Ballot Publicly Auditable
                </div>
            </div>

            <div class="fsec"><i class="fa-solid fa-users-gear"></i> 5. Voter Eligibility & Candidates</div>
            <div class="fg">
                <label>Upload Voter List (CSV/Excel)</label>
                <div style="border: 1px dashed #cbd5e1; padding: 20px; text-align: center; border-radius: 8px;">
                    <i class="fa-solid fa-file-csv" style="font-size: 24px; color: #94a3b8; margin-bottom: 8px;"></i><br>
                    <span style="font-size: 12px; color: #64748b;">Drop CSV file here or click to upload</span>
                </div>
            </div>
            <button class="btn-outline" style="width: 100%; margin-bottom: 20px; justify-content: center; padding: 12px;" onclick="openCandidateModal()">
                <i class="fa-solid fa-user-plus"></i> Configure Candidates (Opens Sub-Editor)
            </button>

            <div class="fsec"><i class="fa-solid fa-shield-halved"></i> 6. Security & Transparency</div>
            <div class="g2">
                <div style="display: flex; align-items: center; justify-content: space-between; background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <span style="font-weight: 600; font-size: 13px;">Blockchain Enabled</span>
                    <i class="fa-solid fa-toggle-on" style="color: #10b981; font-size: 20px;"></i>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; background: #f8fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <span style="font-weight: 600; font-size: 13px;">E2E Encryption</span>
                    <i class="fa-solid fa-toggle-on" style="color: #10b981; font-size: 20px;"></i>
                </div>
            </div>

            <div class="fsec"><i class="fa-solid fa-scale-balanced"></i> 7. Legal & Compliance</div>
            <div class="fg">
                <label>Election Commission / Admin Approval ID</label>
                <input type="text" placeholder="Verification Code">
            </div>
            <div style="font-size: 12px; color: #64748b; display: flex; flex-direction: column; gap: 8px;">
                <label style="display: flex; align-items: flex-start; gap: 10px;">
                    <input type="checkbox" style="margin-top: 3px;">
                    I hereby declare that this election follows the official Code of Conduct and legal guidelines.
                </label>
                <label style="display: flex; align-items: flex-start; gap: 10px;">
                    <input type="checkbox" style="margin-top: 3px;">
                    I understand that once deployed to the Ledger, the schedule cannot be altered.
                </label>
            </div>

            <div style="margin-top: 30px; background: #f0f7ff; padding: 16px; border-radius: 12px; border: 1px solid #dbeafe; display: flex; gap: 12px; align-items: flex-start;">
                <i class="fa-solid fa-circle-nodes" style="color: #3b82f6; margin-top: 4px;"></i>
                <div>
                    <span style="font-weight: 700; color: #1e40af; font-size: 13px;">Matdaan Ledger Pro Tip</span>
                    <p style="font-size: 12px; color: #3b82f6; margin: 4px 0 0;">Deploying this will generate a <strong>Smart Contract Hash</strong>. Ensure your Voter Roster is final to avoid re-deployment gas costs.</p>
                </div>
            </div>
        </div>

        <div style="padding: 24px 32px; background: white; border-top: 1px solid #e2e8f0; display: flex; justify-content: flex-end; gap: 12px;">
            <button style="padding: 12px 24px; border-radius: 10px; border: 1px solid #e2e8f0; background: #fff; font-weight: 600; color: #475569;" onclick="closeModal()">Save as Draft</button>
            <button style="padding: 12px 32px; border-radius: 10px; background: #0f172a; color: #fff; border: none; font-weight: 700; box-shadow: 0 4px 14px rgba(0,0,0,0.2); transition: 0.2s;" 
                    onmouseover="this.style.transform='translateY(-2px)'" 
                    onmouseout="this.style.transform='translateY(0)'"
                    onclick="saveElection()">
                <i class="fa-solid fa-rocket" style="margin-right: 8px;"></i> Deploy to Ledger
            </button>
        </div>
    </div>
</div>

<div class="modal-bg" id="modal-candidate">
    <div class="modal-box" style="max-width: 1000px; display: flex; flex-direction: column; padding: 0;">
        <div style="background: #0f172a; color: white; padding: 20px 32px; display: flex; justify-content: space-between; align-items: center;">
            <h2 id="candidate-modal-title" style="margin:0;">Add Standing Candidate</h2>
            <button onclick="closeCandidateModal()" style="background:none; border:none; color:white; font-size:24px; cursor:pointer;">&times;</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 350px; height: 70vh;">
            <div style="padding: 32px; overflow-y: auto; border-right: 1px solid #e2e8f0;">
                <div id="dynamic-candidate-fields"></div>

                <div class="fsec">Candidate Media</div>
                <div class="g2">
                    <div class="fg">
                        <label>Candidate Photo <span style="color:red">*</span></label>
                        <input type="file" id="cand-photo" accept="image/*" onchange="previewMedia(this, 'res-photo')">
                    </div>
                    <div class="fg">
                        <label>Party Symbol <span style="color:red">*</span></label>
                        <input type="file" id="cand-symbol" accept="image/*" onchange="previewMedia(this, 'res-symbol')">
                    </div>
                </div>
                
                <div class="fg" style="margin-top:15px;">
                    <label>Short Manifesto / Bio</label>
                    <textarea id="cand-bio-input" rows="3" oninput="updatePreviewText()" placeholder="Enter candidate's vision..."></textarea>
                </div>
            </div>

            <div style="background: #f8fafc; padding: 32px; display: flex; flex-direction: column; align-items: center;">
                <div style="font-size: 11px; font-weight: 700; color: #94a3b8; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 1px;">
                    <i class="fa-solid fa-eye"></i> Voter View Preview
                </div>
                
                <div style="background: white; width: 100%; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                    <div style="height: 120px; background: #0f172a; position: relative;">
                        <img id="res-symbol" src="" style="position: absolute; top: 15px; right: 15px; width: 40px; height: 40px; border-radius: 8px; background: white; object-fit: contain; display: none;">
                    </div>
                    <div style="padding: 0 20px 20px; text-align: center; margin-top: -50px;">
                        <img id="res-photo" src="https://via.placeholder.com/100" style="width: 100px; height: 100px; border-radius: 50%; border: 4px solid white; background: #eee; object-fit: cover;">
                        <h3 id="res-name" style="margin-top: 10px; color: #0f172a;">Candidate Name</h3>
                        <p id="res-party" style="font-size: 12px; color: #3b82f6; font-weight: 600; text-transform: uppercase;">Independent</p>
                        <div style="margin: 15px 0; height: 1px; background: #f1f5f9;"></div>
                        <p id="res-bio" style="font-size: 13px; color: #64748b; line-height: 1.5; font-style: italic;">"Vision for a better tomorrow..."</p>
                        <button style="width: 100%; margin-top: 20px; padding: 12px; border-radius: 8px; background: #f1f5f9; color: #0f172a; border: none; font-weight: 700; font-size: 13px;">Vote for Candidate</button>
                    </div>
                </div>
            </div>
        </div>

        <div style="padding: 20px 32px; background: white; border-top: 1px solid #e2e8f0; display: flex; justify-content: flex-end; gap: 12px;">
            <button class="btn-outline" onclick="closeCandidateModal()">Cancel</button>
            <button style="padding:10px 24px; border-radius:8px; background:#0f172a; color:#fff; border:none; font-weight:700;" onclick="saveCandidate()">
                <i class="fa-solid fa-cloud-arrow-up" style="margin-right:8px;"></i> Add Candidate to Ledger
            </button>
        </div>
    </div>
</div>

<div class="toast-stack" id="toast-stack"></div>

<script>
    // --- CHART ---
    const ctx = document.getElementById('activityChart').getContext('2d');
    const activityChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Ballots Cast',
                data: [0, 0, 0, 0, 0, 0, 0],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.05)',
                fill: true,
                tension: 0.4,
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: '#fff',
                pointBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: '#f1f5f9' }, border: { display: false } },
                x: { grid: { display: false }, border: { display: false } }
            }
        }
    });

    // --- NAVIGATION ---
    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const targetPage = document.getElementById('page-' + id);
        if(targetPage) targetPage.classList.add('active');
        
        document.querySelectorAll('.sb-item').forEach(i => i.classList.remove('sb-active'));
        const btn = document.getElementById('sbi-' + id);
        if(btn) btn.classList.add('sb-active');
    }

    function showElectionDetail(name) {
        document.getElementById('detail-title').innerText = name;
        document.getElementById('preview-election-display').innerText = name;
        switchElectionTab('overview');
        showPage('election-detail');
    }

    function switchElectionTab(tab) {
        document.getElementById('detail-overview-content').style.display = 'none';
        document.getElementById('detail-voters-content').style.display = 'none';
        document.getElementById('detail-branding-content').style.display = 'none';
        
        document.querySelectorAll('.d-tab').forEach(t => t.classList.remove('active'));
        
        if(tab === 'overview') {
            document.getElementById('detail-overview-content').style.display = 'block';
            document.querySelector('.d-tab:nth-child(1)').classList.add('active');
            addScannerSection(document.getElementById('detail-overview-content'), document.getElementById('detail-title').innerText);
        } else if (tab === 'voters') {
            document.getElementById('detail-voters-content').style.display = 'block';
            document.querySelector('.d-tab:nth-child(3)').classList.add('active');
            renderVoterRoster();
        } else if (tab === 'branding') {
            document.getElementById('detail-branding-content').style.display = 'block';
            document.querySelector('.d-tab:nth-child(4)').classList.add('active');
            updateBrandPreview();
        }
    }

    // --- UTILS ---
    function openCreateModal() { document.getElementById('modal-create').classList.add('open'); }
    function closeModal() { document.getElementById('modal-create').classList.remove('open'); }
    function closeCandidateModal() { document.getElementById('modal-candidate').classList.remove('open'); }

    function toast(msg, type='ok') {
        const stack = document.getElementById('toast-stack');
        const t = document.createElement('div');
        t.className = 'toast';
        t.innerText = msg;
        stack.appendChild(t);
        setTimeout(() => t.remove(), 3000);
    }

    // --- SCANNER & PREVIEW LOGIC ---
    function addScannerSection(container, name) {
        const existingScanner = document.getElementById('scanner-box');
        if(existingScanner) existingScanner.remove();
        const scannerDiv = document.createElement('div');
        scannerDiv.id = 'scanner-box';
        scannerDiv.style = "margin-top: 24px; padding: 24px; background: #fff; border: 1px solid #e2e8f0; border-radius: 12px;";
        const randomId = Math.random().toString(36).substring(7).toUpperCase();
        const electionLink = `https://democrazy.io/vote/${randomId}`;
        const qrApi = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(electionLink)}`;
        scannerDiv.innerHTML = `<div class="panel-title"><i class="fa-solid fa-qrcode"></i> Election Access Scanner</div><div style="display: flex; gap: 32px; align-items: center;"><div style="background: #f8fafc; padding: 15px; border: 1px solid #e2e8f0; border-radius: 10px;"><img src="${qrApi}" alt="QR"></div><div><p style="font-weight: 700; color: #0f172a;">Direct Link:</p><a href="#" style="color: #3b82f6; font-size: 13px;">${electionLink}</a><div style="margin-top: 15px; font-size: 12px; color: #64748b; background: #f0f7ff; padding: 10px; border-radius: 6px;"><strong>Scanner Validity:</strong><br><i class="fa-regular fa-clock"></i> Generated: ${new Date().toLocaleString()}<br><i class="fa-solid fa-hourglass-end"></i> Valid Until: 7 Days</div></div></div>`;
        container.appendChild(scannerDiv);
    }

    function updatePreviewText() {
        const nameInput = document.getElementById('cand-name');
        const partyInput = document.getElementById('cand-party');
        const bioInput = document.getElementById('cand-bio-input');
        if(nameInput) document.getElementById('res-name').innerText = nameInput.value || "Candidate Name";
        if(partyInput) document.getElementById('res-party').innerText = partyInput.value || "Independent";
        if(bioInput) document.getElementById('res-bio').innerText = bioInput.value ? `"${bioInput.value}"` : '"Vision for a better tomorrow..."';
    }

    function previewMedia(input, targetId) {
        const target = document.getElementById(targetId);
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) { target.src = e.target.result; target.style.display = 'block'; }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function openCandidateModal() {
        const type = document.getElementById('el-type').value;
        const container = document.getElementById('dynamic-candidate-fields');
        container.innerHTML = `<div class="fsec">Basic Info</div><div class="fg"><label>Full Name <span style="color:red">*</span></label><input type="text" id="cand-name" oninput="updatePreviewText()"></div><div class="g2"><div class="fg"><label>Party Name</label><input type="text" id="cand-party" oninput="updatePreviewText()"></div><div class="fg"><label>Candidate ID</label><input type="text" id="cand-id-num"></div></div>`;
        if(type === "University / College") container.innerHTML += `<div class="fsec">Academic Verification</div><div class="g2"><div class="fg"><label>Roll Number</label><input type="text"></div><div class="fg"><label>CGPA</label><input type="number" step="0.1"></div></div>`;
        document.getElementById('modal-candidate').classList.add('open');
        updatePreviewText();
    }

    function saveElection() {
        const title = document.getElementById('el-title').value;
        if(!title) return toast("Election title is required", "err");
        toast("Committing to Blockchain Ledger...", "inf");
        setTimeout(() => { closeModal(); toast("Election Successfully Deployed!", "ok"); }, 1800);
    }

    function renderVoterRoster() {
        const container = document.getElementById('voter-list-container');
        container.innerHTML = '';
        const voterData = [{ id: 1, key: "MJA-X9-UAM" }, { id: 2, key: "EQ2-B4-2KN" }];
        voterData.forEach(voter => {
            const div = document.createElement('div');
            div.className = 'voter-item';
            div.innerHTML = `<input type="checkbox" class="voter-checkbox"><div class="voter-info"><div class="voter-name">Participant ${voter.id} <span class="tag-unused">Unused</span></div><div class="voter-meta">Verified Participant</div></div><div class="voter-key-box">${voter.key}</div>`;
            container.appendChild(div);
        });
    }

    function updateBrandPreview() {
        const inputVal = document.getElementById('brand-org-input').value;
        document.getElementById('preview-org-display').innerText = inputVal || "Organization Name";
    }

    function selectTheme(element, color, name) {
        document.querySelectorAll('.theme-item').forEach(t => t.classList.remove('active'));
        element.classList.add('active');
        document.getElementById('brand-hex-input').value = color.toUpperCase();
        document.getElementById('preview-logo-container').style.background = color + '15';
        document.getElementById('preview-logo-icon').style.color = color;
        document.getElementById('preview-btn').style.background = color;
    }
</script>
</body>
</html>